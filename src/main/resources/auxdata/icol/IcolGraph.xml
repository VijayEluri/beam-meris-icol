<graph>
    <id>icolDeomProduct</id>

    <node>
        <id>l1b</id>
        <operator>org.esa.beam.framework.gpf.operators.common.ReadProductOp$Spi</operator>
        <parameters>
            <filePath>${inputFile1}</filePath>
        </parameters>
    </node>

    <node>
        <id>refl</id>
        <operator>org.esa.beam.meris.brr.Rad2ReflOp$Spi</operator>
        <sources>
            <input>l1b</input>
        </sources>
    </node>

    <node>
        <id>cloudclassif</id>
        <operator>org.esa.beam.meris.brr.CloudClassificationOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <rhotoa>refl</rhotoa>
        </sources>
    </node>

    <node>
        <id>gascor</id>
        <operator>org.esa.beam.meris.brr.GaseousCorrectionOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <rhotoa>refl</rhotoa>
            <cloud>cloudclassif</cloud>
        </sources>
        <parameters>
            <correctWater>true</correctWater>
            <exportTg>true</exportTg>
        </parameters>
    </node>

    <node>
        <id>landClass</id>
        <operator>org.esa.beam.meris.brr.LandClassificationOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <gascor>gascor</gascor>
        </sources>
    </node>
    
    <node>
        <id>fresnel</id>
        <operator>org.esa.beam.meris.icol.FresnelCoefficientOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <land>landClass</land>
            <input>gascor</input>
        </sources>
    </node>    

    <node>
        <id>ray</id>
        <operator>org.esa.beam.meris.brr.RayleighCorrectionOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <land>landClass</land>
            <input>fresnel</input>
        </sources>
        <parameters>
            <correctWater>true</correctWater>
            <exportRayCoeffs>true</exportRayCoeffs>
        </parameters>
    </node>

    <node>
        <id>aemask</id>
        <operator>org.esa.beam.meris.icol.AEMaskOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <land>landClass</land>
        </sources>
        <parameters>
            <landExpression>land_classif_flags.F_LANDCONS</landExpression>
        </parameters>
    </node>

    <node>
        <id>landDistance</id>
        <operator>org.esa.beam.meris.icol.LandDistanceOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <land>landClass</land>
        </sources>
        <parameters>
            <landExpression>land_classif_flags.F_LANDCONS</landExpression>
        </parameters>
    </node>

    <node>
        <id>zmax</id>
        <operator>org.esa.beam.meris.icol.ZmaxOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <landDistance>landDistance</landDistance>
            <ae_mask>aemask</ae_mask>
        </sources>
    </node>

    <node>
        <id>ae_ray</id>
        <operator>org.esa.beam.meris.icol.AeRayleighOp$Spi</operator>
        <sources>
            <l1b>l1b</l1b>
            <aemask>aemask</aemask>
            <ray1b>ray</ray1b>
            <rhoNg>gascor</rhoNg>
            <zmax>zmax</zmax>
        </sources>
    </node>
    
    <node>
        <id>ae_aerosol</id>
        <operator>org.esa.beam.meris.icol.AeAerosolOp$Spi</operator>
        <sources>
        	<l1b>l1b</l1b>
            <aemask>aemask</aemask>
            <zmax>zmax</zmax>
            <input>ae_ray</input>
        </sources>
    </node>
    
    <node>
        <id>reverse</id>
        <operator>org.esa.beam.meris.icol.ReverseDemoProductOp$Spi</operator>
        <sources>
        	<rhotoa>refl</rhotoa>
        	<aemask>aemask</aemask>
            <gascor>gascor</gascor>
            <ae_ray>ae_ray</ae_ray>
            <ae_aerosol>ae_aerosol</ae_aerosol>
        </sources>
    </node>
    
    <node>
        <id>merged</id>
        <operator>Merge</operator>
        <sources>
            <l1b>l1b</l1b>
            <cloudclassif>cloudclassif</cloudclassif>
            <gascor>gascor</gascor>
            <landClass>landClass</landClass>
            <ray>ray</ray>
            <ae_ray>ae_ray</ae_ray>
            <aemask>aemask</aemask>
            <zmax>zmax</zmax>
            <refl>refl</refl>
            <fresnel>fresnel</fresnel>
            <landDistance>landDistance</landDistance>
            <ae_aerosol>ae_aerosol</ae_aerosol>
            <reverse>reverse</reverse>
        </sources>
        <parameters>
            <productType>MER_FR__1P</productType>
            <copyGeoCodingFrom>l1b</copyGeoCodingFrom>
            <band>
                <product>refl</product>
                <nameExp>.*</nameExp>
            </band>
            <band>
                <product>ray</product>
                <nameExp>brr.*</nameExp>
            </band>
            <band>
                <product>ae_ray</product>
                <nameExp>rho_aeRay.*</nameExp>
            </band>
            <band>
                <product>ae_aerosol</product>
                <nameExp>rho_aeAer.*</nameExp>
            </band>
            <band>
                <product>reverse</product>
                <nameExp>.*</nameExp>
            </band>
            
            <band>
                <product>ae_aerosol</product>
                <nameExp>a.*</nameExp>
            </band>
            
            <band>
              <product>l1b</product>
              <name>l1_flags</name>
            </band>
            <band>
                <product>aemask</product>
                <nameExp>.*</nameExp>
            </band>
            <band>
                <product>zmax</product>
                <nameExp>.*</nameExp>
            </band>
            <band>
                <product>landDistance</product>
                <nameExp>.*</nameExp>
            </band>
            <band>
                <product>cloudclassif</product>
                <name>cloud_classif_flags</name>
            </band>
            <band>
                <product>landClass</product>
                <name>land_classif_flags</name>
            </band>
        </parameters>
    </node>    
    
    <node>
        <id>write</id>
        <operator>org.esa.beam.framework.gpf.operators.common.WriteProductOp$Spi</operator>
        <sources>
            <input>merged</input>
        </sources>
        <parameters>
            <filePath>${outputFile1}</filePath>
        </parameters>
    </node>

</graph>